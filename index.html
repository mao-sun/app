<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è§†å£è®¾ç½®ï¼šé€‚é…åˆ˜æµ·å±ï¼Œç¦æ­¢ç¼©æ”¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mao's Journey</title>
    
    <!-- PWA é…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2F2F7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* iOS 17 é£æ ¼é…è‰² */
            --ios-bg: #F2F2F7;
            --ios-card: #FFFFFF;
            --ios-text: #000000;
            --ios-subtext: #8E8E93;
            --ios-blue: #007AFF;
            --ios-separator: rgba(60, 60, 67, 0.12);
            --ios-green: #34C759;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "PingFang SC", sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body { 
            background-color: var(--ios-bg);
            color: var(--ios-text);
            /* ä¸ºåº•éƒ¨å¯¼èˆªæ ç•™å‡ºç©ºé—´ */
            padding-bottom: calc(90px + var(--safe-bottom)); 
            /* é¡¶éƒ¨ç•™ç™½ï¼Œé˜²æ­¢é®æŒ¡ */
            padding-top: calc(160px + var(--safe-top));
        }

        /* --- é¡¶éƒ¨å›ºå®šåŒºåŸŸ (Header + Search + Tabs) --- */
        .fixed-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: rgba(242, 242, 247, 0.85);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            z-index: 1000;
            padding-top: max(12px, var(--safe-top));
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }

        .app-title {
            text-align: center;
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        /* æœç´¢æ¡†å®¹å™¨ */
        .search-wrapper {
            padding: 0 16px 12px;
            position: relative;
        }

        .search-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-box {
            width: 100%;
            height: 40px;
            background: rgba(118, 118, 128, 0.12);
            border: none;
            border-radius: 10px;
            padding: 0 40px 0 36px;
            font-size: 17px;
            color: var(--ios-text);
        }
        
        .search-box::placeholder { color: var(--ios-subtext); }
        .search-box:focus { outline: none; background: rgba(118, 118, 128, 0.18); }

        .search-icon {
            position: absolute; left: 10px;
            color: var(--ios-subtext); font-size: 16px;
        }

        .clear-btn {
            position: absolute; right: 10px;
            background: #8E8E93; color: white;
            border: none; border-radius: 50%;
            width: 16px; height: 16px;
            font-size: 10px; display: none;
            align-items: center; justify-content: center;
        }
        .clear-btn.visible { display: flex; }

        /* åˆ†æ®µæ§åˆ¶å™¨ (Segmented Control) */
        .segmented-control {
            display: flex;
            margin: 0 16px 12px;
            background: rgba(118, 118, 128, 0.12);
            border-radius: 9px;
            padding: 2px;
            position: relative;
        }

        .segment-btn {
            flex: 1;
            text-align: center;
            padding: 6px 0;
            font-size: 13px;
            font-weight: 500;
            color: var(--ios-text);
            z-index: 2;
            cursor: pointer;
            transition: all 0.2s;
        }

        .segment-btn.active {
            font-weight: 600;
        }

        /* æ»‘å—åŠ¨ç”»èƒŒæ™¯ */
        .segment-bg {
            position: absolute;
            top: 2px; left: 2px;
            width: calc(50% - 2px);
            height: calc(100% - 4px);
            background: #fff;
            border-radius: 7px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.12);
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            z-index: 1;
        }

        /* --- ä¸»è¦å†…å®¹åŒºåŸŸ --- */
        .tab-content {
            display: none;
            padding: 0 16px;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active-view {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* åŒºåŸŸå¡ç‰‡ */
        .region-card {
            background: var(--ios-card);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }

        .region-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 0.5px solid transparent;
            transition: background 0.2s;
        }

        .region-header:active { background: #F2F2F7; }
        
        /* å±•å¼€æ—¶çš„åˆ†å‰²çº¿ */
        .region-header:not(.collapsed) {
            border-bottom-color: var(--ios-separator);
        }

        .region-header span { display: flex; align-items: center; gap: 8px; }
        .region-header i { 
            color: #C7C7CC; 
            font-size: 14px; 
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); 
        }
        
        .region-header.collapsed i { transform: rotate(-90deg); }

        /* ç½‘æ ¼å¸ƒå±€ */
        .region-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
            padding: 16px;
            background: var(--ios-card);
            /* å…³é”®ï¼šè®©ç½‘æ ¼å†…çš„é¡¹ç›®é«˜åº¦è‡ªåŠ¨æ‹‰ä¼¸ï¼Œå®ç°ç­‰é«˜å¸ƒå±€ */
            align-items: stretch;
        }
        .region-content.collapsed { display: none; }

        /* ç›®çš„åœ°èƒ¶å›Š (Pills) */
        .area-item {
            background: #F2F2F7;
            border-radius: 8px;
            padding: 12px 6px; /* å¢åŠ å·¦å³ padding */
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            
            /* ä¸­æ–‡å›ºå®šåœ¨é¡¶éƒ¨ */
            justify-content: flex-start;
            padding-top: 14px;
            
            /* å…³é”®ä¿®æ”¹ï¼šç§»é™¤å›ºå®šé«˜åº¦ï¼Œä½¿ç”¨ flex-grow æ’‘æ»¡é«˜åº¦ï¼Œä½†å…è®¸å†…å®¹æ’‘å¼€ */
            height: 100%; 
            min-height: 70px;
            transition: transform 0.2s;
        }

        .area-item:active { transform: scale(0.96); }

        .area-item a { text-decoration: none; color: inherit; width: 100%; }
        
        .area-item span {
            font-size: 14px;
            font-weight: 500;
            
            /* å…³é”®ä¿®æ”¹ï¼šå…è®¸æ¢è¡Œï¼Œå°Šé‡æ‰€æœ‰åœ°åé•¿åº¦ */
            white-space: normal; 
            overflow: visible;
            text-overflow: unset;
            
            display: block;
            width: 100%;
            line-height: 1.35; /* å¢åŠ è¡Œé«˜ï¼Œå¤šè¡Œæ—¶æ›´æ¸…æ™° */
            margin-bottom: 2px;
        }

        .country-en {
            font-size: 10px;
            color: var(--ios-subtext);
            margin-top: 4px;
            /* å…³é”®ä¿®æ”¹ï¼šè‹±æ–‡ä¹Ÿå…è®¸æ¢è¡Œ */
            white-space: normal;
            line-height: 1.25;
            word-wrap: break-word; /* é˜²æ­¢é•¿å•è¯æº¢å‡º */
            width: 100%;
            padding: 0 2px;
        }

        /* å®Œæˆå¾½ç«  */
        .completed-badge {
            position: absolute;
            top: -6px; right: -6px;
            background: var(--ios-green);
            color: white;
            width: 18px; height: 18px;
            border-radius: 50%;
            font-size: 10px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--ios-card);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 2; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
        }

        /* é«˜äº®æ ·å¼ */
        .highlight {
            background: #FFF4CE !important;
            box-shadow: 0 0 0 2px #FFD60A inset;
            animation: pulse 1s infinite;
        }
        
        .match-highlight { border: 1px solid var(--ios-blue); background: #EAF4FF; }

        @keyframes pulse { 50% { transform: scale(1.05); } }

        /* æœç´¢å»ºè®®åˆ—è¡¨ */
        .suggestions-container {
            position: fixed;
            top: calc(110px + var(--safe-top)); /* ç´§è´´ Header ä¸‹æ–¹ */
            left: 16px; right: 16px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            max-height: 50vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
        }

        .suggestion-item {
            padding: 14px 16px;
            border-bottom: 0.5px solid var(--ios-separator);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .suggestion-item:last-child { border-bottom: none; }
        .highlight-text { color: var(--ios-blue); font-weight: 600; }

        /* --- åº•éƒ¨å·¥å…·æ  (Bottom Tab Bar) --- */
        .bottom-toolbar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: calc(60px + var(--safe-bottom));
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-around;
            padding-bottom: var(--safe-bottom);
            z-index: 1000;
        }

        .tool-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--ios-subtext);
            font-size: 10px;
            gap: 4px;
            cursor: pointer;
        }
        
        .tool-btn i { font-size: 20px; margin-bottom: 2px; }
        .tool-btn:active { color: var(--ios-blue); opacity: 0.7; }

        /* æç¤º Toast */
        .toast-msg {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            z-index: 3000;
            white-space: nowrap;
            display: flex; align-items: center; gap: 8px;
        }
        .toast-msg.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* --- å ä½ç¬¦ IDï¼Œå¿…é¡»ä¿ç•™ä»¥é…åˆåŸç”Ÿ JS --- */
        .search-btn-hidden { display: none; } /* åŸ JS éœ€è¦ searchButton */
    </style>
</head>
<body>

    <!-- 1. é¡¶éƒ¨å›ºå®šåŒºåŸŸ -->
    <div class="fixed-header">
        <div class="app-title">Mao's Journey</div>
        
        <div class="search-wrapper">
            <div class="search-input-group">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" id="searchInput" placeholder="æœç´¢ç›®çš„åœ° (å¦‚: æ—¥æœ¬)">
                <button class="clear-btn" id="clearBtn"><i class="fas fa-times"></i></button>
            </div>
            <!-- ç”¨äº JS ç»‘å®šçš„éšè—æŒ‰é’® -->
            <button id="searchButton" class="search-btn-hidden"></button>
        </div>

        <div class="segmented-control">
            <div class="segment-bg" id="segmentBg"></div>
            <div class="segment-btn active" onclick="switchTab('china', this)">ğŸ‡¨ğŸ‡³ æ¢ç´¢ä¸­å›½</div>
            <div class="segment-btn" onclick="switchTab('world', this)">ğŸŒ ç¯æ¸¸ä¸–ç•Œ</div>
        </div>
    </div>

    <!-- æœç´¢å»ºè®®æ‚¬æµ®å±‚ -->
    <div class="suggestions-container" id="suggestionsContainer"></div>

    <!-- 2. ä¸»è¦å†…å®¹åŒºåŸŸ (Tab 1: ä¸­å›½) -->
    <div id="tab-china" class="tab-content active-view">
        <div class="region-card">
            <div class="region-header" data-region="northNortheastChina">
                <span>ååŒ—-ä¸œåŒ—åœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="northNortheastChinaContent"></div>
        </div>
        
        <div class="region-card">
            <div class="region-header" data-region="eastChina">
                <span>åä¸œåœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="eastChinaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="centralSouthChina">
                <span>åä¸­-åå—åœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="centralSouthChinaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="southwestChina">
                <span>è¥¿å—åœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="southwestChinaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="northwestChina">
                <span>è¥¿åŒ—åœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="northwestChinaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="hmtChina">
                <span>æ¸¯æ¾³å°åœ°åŒº</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="hmtChinaContent"></div>
        </div>
    </div>

    <!-- 3. ä¸»è¦å†…å®¹åŒºåŸŸ (Tab 2: å¢ƒå¤–) -->
    <div id="tab-world" class="tab-content">
        <div class="region-card">
            <div class="region-header" data-region="asia">
                <span>äºšæ´² (Asia)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="asiaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="europe">
                <span>æ¬§æ´² (Europe)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="europeContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="northAmerica">
                <span>åŒ—ç¾æ´² (North America)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="northAmericaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="southAmerica">
                <span>å—ç¾æ´² (South America)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="southAmericaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="oceania">
                <span>å¤§æ´‹æ´² (Oceania)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="oceaniaContent"></div>
        </div>

        <div class="region-card">
            <div class="region-header" data-region="africa">
                <span>éæ´² (Africa)</span><i class="fas fa-chevron-down"></i>
            </div>
            <div class="region-content" id="africaContent"></div>
        </div>
    </div>

    <!-- 4. åº•éƒ¨å·¥å…·æ  -->
    <div class="bottom-toolbar">
        <div class="tool-btn" id="hintBtn">
            <i class="far fa-question-circle"></i>
            <span>è¯´æ˜</span>
        </div>
        <div class="tool-btn" id="collapseExpandBtn">
            <i class="fas fa-compress-alt"></i>
            <span>æŠ˜å /å±•å¼€</span>
        </div>
        <div class="tool-btn" id="backToTop">
            <i class="fas fa-arrow-up"></i>
            <span>é¡¶éƒ¨</span>
        </div>
    </div>

    <!-- Toast æç¤ºæ¡† (æ›¿ä»£åŸæœ‰çš„æ‚¬æµ®çª—) -->
    <div class="toast-msg" id="hintPanel">
        <i class="fas fa-check-circle" style="color:#34C759"></i> å·²å®Œæˆ
        <span style="margin: 0 8px; opacity: 0.3">|</span>
        <i class="fas fa-lightbulb" style="color:#FF9F0A"></i> ç‚¹å‡»æ ‡é¢˜æŠ˜å 
    </div>

    <!-- ============================================== -->
    <!-- åŸæœ‰ JavaScript é€»è¾‘ (100% ä¿ç•™) -->
    <!-- ============================================== -->
    <script>
        // ------------------------------------------------
        // æ–°å¢çš„ UI äº¤äº’è„šæœ¬ (å¤„ç† Tab åˆ‡æ¢)
        // ------------------------------------------------
        function switchTab(type, btnElement) {
            // 1. å¤„ç†é¡¶éƒ¨æŒ‰é’®æ ·å¼
            document.querySelectorAll('.segment-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
            
            const bg = document.getElementById('segmentBg');
            if (type === 'china') {
                bg.style.transform = 'translateX(0)';
            } else {
                bg.style.transform = 'translateX(100%)';
            }

            // 2. åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active-view'));
            if (type === 'china') {
                document.getElementById('tab-china').classList.add('active-view');
            } else {
                document.getElementById('tab-world').classList.add('active-view');
            }
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // ------------------------------------------------
        // åŸæœ‰æ ¸å¿ƒé€»è¾‘ (Copy from original)
        // ------------------------------------------------
        const completedChinaProvinces = ["åŒ—äº¬å¸‚", "æ±Ÿè‹çœ", "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº", "å››å·çœ", "é‡åº†å¸‚"];
        const chinaRegions = {
            northNortheastChina: ["åŒ—äº¬å¸‚", "å¤©æ´¥å¸‚", "æ²³åŒ—çœ", "å±±è¥¿çœ", "å†…è’™å¤è‡ªæ²»åŒº", "è¾½å®çœ", "å‰æ—çœ", "é»‘é¾™æ±Ÿçœ"],
            eastChina: ["ä¸Šæµ·å¸‚", "æ±Ÿè‹çœ", "æµ™æ±Ÿçœ", "å®‰å¾½çœ", "ç¦å»ºçœ", "æ±Ÿè¥¿çœ", "å±±ä¸œçœ"],
            centralSouthChina: ["æ²³å—çœ", "æ¹–åŒ—çœ", "æ¹–å—çœ", "å¹¿ä¸œçœ", "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº", "æµ·å—çœ"],
            southwestChina: ["é‡åº†å¸‚", "å››å·çœ", "è´µå·çœ", "äº‘å—çœ", "è¥¿è—è‡ªæ²»åŒº"],
            northwestChina: ["é™•è¥¿çœ", "ç”˜è‚ƒçœ", "é’æµ·çœ", "å®å¤å›æ—è‡ªæ²»åŒº", "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº"],
            hmtChina: ["é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº", "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº", "å°æ¹¾çœ"]
        };
        const countries = {
            asia: [{name: "æ—¥æœ¬", en: "Japan", completed: true}, {name: "éŸ©å›½", en: "South Korea", completed: false}, {name: "è¶Šå—", en: "Vietnam", completed: true}, {name: "æ³°å›½", en: "Thailand", completed: false}, {name: "æ–°åŠ å¡", en: "Singapore", completed: false}, {name: "é©¬æ¥è¥¿äºš", en: "Malaysia", completed: false}, {name: "å°åº¦å°¼è¥¿äºš", en: "Indonesia", completed: false}, {name: "è²å¾‹å®¾", en: "Philippines", completed: false}, {name: "æŸ¬åŸ”å¯¨", en: "Cambodia", completed: false}, {name: "è€æŒ", en: "Laos", completed: false}, {name: "æ–¯é‡Œå…°å¡", en: "Sri Lanka", completed: false}, {name: "é©¬å°”ä»£å¤«", en: "Maldives", completed: false}, {name: "é˜¿è”é…‹", en: "United Arab Emirates", completed: false}, {name: "åœŸè€³å…¶", en: "Turkey", completed: false}, {name: "ä¸­å›½é¦™æ¸¯", en: "Hong Kong, China", completed: true}, {name: "ä¸­å›½æ¾³é—¨", en: "Macao, China", completed: false}, {name: "ä¸­å›½å°æ¹¾", en: "Taiwan, China", completed: false}],
            europe: [{name: "è‹±å›½", en: "United Kingdom", completed: false}, {name: "æ³•å›½", en: "France", completed: false}, {name: "å¾·å›½", en: "Germany", completed: false}, {name: "æ„å¤§åˆ©", en: "Italy", completed: false}, {name: "è¥¿ç­ç‰™", en: "Spain", completed: false}, {name: "è‘¡è„ç‰™", en: "Portugal", completed: false}, {name: "è·å…°", en: "Netherlands", completed: false}, {name: "æ¯”åˆ©æ—¶", en: "Belgium", completed: false}, {name: "ç‘å£«", en: "Switzerland", completed: false}, {name: "å¥¥åœ°åˆ©", en: "Austria", completed: false}, {name: "å¸Œè…Š", en: "Greece", completed: false}, {name: "å†°å²›", en: "Iceland", completed: false}, {name: "æŒªå¨", en: "Norway", completed: false}, {name: "ç‘å…¸", en: "Sweden", completed: false}, {name: "ä¸¹éº¦", en: "Denmark", completed: false}, {name: "èŠ¬å…°", en: "Finland", completed: false}, {name: "ä¿„ç½—æ–¯", en: "Russia", completed: false}, {name: "æ·å…‹", en: "Czech Republic", completed: false}, {name: "åŒˆç‰™åˆ©", en: "Hungary", completed: false}, {name: "æ³¢å…°", en: "Poland", completed: false}],
            northAmerica: [{name: "ç¾å›½", en: "United States", completed: false}, {name: "åŠ æ‹¿å¤§", en: "Canada", completed: false}, {name: "å¢¨è¥¿å“¥", en: "Mexico", completed: false}, {name: "å¤å·´", en: "Cuba", completed: false}, {name: "å“¥æ–¯è¾¾é»åŠ ", en: "Costa Rica", completed: false}, {name: "å·´æ‹¿é©¬", en: "Panama", completed: false}],
            southAmerica: [{name: "å·´è¥¿", en: "Brazil", completed: false}, {name: "é˜¿æ ¹å»·", en: "Argentina", completed: false}, {name: "æ™ºåˆ©", en: "Chile", completed: false}, {name: "ç§˜é²", en: "Peru", completed: false}, {name: "å“¥ä¼¦æ¯”äºš", en: "Colombia", completed: false}],
            oceania: [{name: "æ¾³å¤§åˆ©äºš", en: "Australia", completed: false}, {name: "æ–°è¥¿å…°", en: "New Zealand", completed: false}, {name: "æ–æµ", en: "Fiji", completed: false}, {name: "è¨æ‘©äºš", en: "Samoa", completed: false}, {name: "æ±¤åŠ ", en: "Tonga", completed: false}, {name: "æ³•å±æ³¢åˆ©å°¼è¥¿äºš", en: "French Polynesia", completed: false}],
            africa: [{name: "åŸƒåŠ", en: "Egypt", completed: false}, {name: "å—é", en: "South Africa", completed: false}, {name: "è‚¯å°¼äºš", en: "Kenya", completed: false}, {name: "æ‘©æ´›å“¥", en: "Morocco", completed: false}, {name: "å¦æ¡‘å°¼äºš", en: "Tanzania", completed: false}]
        };
        let allDestinations = [];
        const provinceEnMap = {"åŒ—äº¬å¸‚": "Beijing", "å¤©æ´¥å¸‚": "Tianjin", "æ²³åŒ—çœ": "Hebei", "å±±è¥¿çœ": "Shanxi", "å†…è’™å¤è‡ªæ²»åŒº": "InnerMongolia", "è¾½å®çœ": "Liaoning", "å‰æ—çœ": "Jilin", "é»‘é¾™æ±Ÿçœ": "Heilongjiang", "ä¸Šæµ·å¸‚": "Shanghai", "æ±Ÿè‹çœ": "Jiangsu", "æµ™æ±Ÿçœ": "Zhejiang", "å®‰å¾½çœ": "Anhui", "ç¦å»ºçœ": "Fujian", "æ±Ÿè¥¿çœ": "Jiangxi", "å±±ä¸œçœ": "Shandong", "æ²³å—çœ": "Henan", "æ¹–åŒ—çœ": "Hubei", "æ¹–å—çœ": "Hunan", "å¹¿ä¸œçœ": "Guangdong", "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº": "Guangxi", "æµ·å—çœ": "Hainan", "é‡åº†å¸‚": "Chongqing", "å››å·çœ": "Sichuan", "è´µå·çœ": "Guizhou", "äº‘å—çœ": "Yunnan", "è¥¿è—è‡ªæ²»åŒº": "Tibet", "é™•è¥¿çœ": "Shaanxi", "ç”˜è‚ƒçœ": "Gansu", "é’æµ·çœ": "Qinghai", "å®å¤å›æ—è‡ªæ²»åŒº": "Ningxia", "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº": "Xinjiang", "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº": "HongKong", "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº": "Macao", "å°æ¹¾çœ": "Taiwan"};
        const provinceRegionMap = {"åŒ—äº¬å¸‚": "NorthChina", "å¤©æ´¥å¸‚": "NorthChina", "æ²³åŒ—çœ": "NorthChina", "å±±è¥¿çœ": "NorthChina", "å†…è’™å¤è‡ªæ²»åŒº": "NorthChina", "è¾½å®çœ": "NortheastChina", "å‰æ—çœ": "NortheastChina", "é»‘é¾™æ±Ÿçœ": "NortheastChina", "ä¸Šæµ·å¸‚": "EastChina", "æ±Ÿè‹çœ": "EastChina", "æµ™æ±Ÿçœ": "EastChina", "å®‰å¾½çœ": "EastChina", "ç¦å»ºçœ": "EastChina", "æ±Ÿè¥¿çœ": "EastChina", "å±±ä¸œçœ": "EastChina", "æ²³å—çœ": "CentralChina", "æ¹–åŒ—çœ": "CentralChina", "æ¹–å—çœ": "CentralChina", "å¹¿ä¸œçœ": "SouthChina", "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº": "SouthChina", "æµ·å—çœ": "SouthChina", "é‡åº†å¸‚": "SouthwestChina", "å››å·çœ": "SouthwestChina", "è´µå·çœ": "SouthwestChina", "äº‘å—çœ": "SouthwestChina", "è¥¿è—è‡ªæ²»åŒº": "SouthwestChina", "é™•è¥¿çœ": "NorthwestChina", "ç”˜è‚ƒçœ": "NorthwestChina", "é’æµ·çœ": "NorthwestChina", "å®å¤å›æ—è‡ªæ²»åŒº": "NorthwestChina", "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº": "NorthwestChina", "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº": "China", "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº": "China", "å°æ¹¾çœ": "China"};
        const continentMap = {asia: "Asia", europe: "Europe", northAmerica: "NorthAmerica", southAmerica: "SouthAmerica", oceania: "Oceania", africa: "Africa"};

        function highlightMatch(text, query) { if (!query) return text; const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi'); return text.replace(regex, '<span class="highlight-text">$1</span>'); }
        function escapeRegExp(string) { return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
        
        function initPage() {
            // å¡«å……ä¸­å›½æ•°æ®
            for (const region in chinaRegions) { const contentElement = document.getElementById(`${region}Content`); if (contentElement) { chinaRegions[region].forEach(province => { const item = document.createElement('div'); item.className = 'area-item'; const regionPrefix = provinceRegionMap[province]; const provinceEn = provinceEnMap[province]; let link = `${regionPrefix}-${provinceEn}.html`; item.innerHTML = `<a href="${link}"><span>${province}</span></a>`; item.dataset.name = province; contentElement.appendChild(item); if (completedChinaProvinces.includes(province)) { const badge = document.createElement('div'); badge.className = 'completed-badge'; badge.innerHTML = '<i class="fas fa-check"></i>'; item.appendChild(badge); } allDestinations.push({name: province, en: null, type: 'china', element: item, completed: completedChinaProvinces.includes(province)}); }); } }
            // å¡«å……ä¸–ç•Œæ•°æ®
            for (const continent in countries) { const contentElement = document.getElementById(`${continent}Content`); if (contentElement) { countries[continent].forEach(country => { const countryElement = document.createElement('div'); countryElement.className = 'area-item'; let link; let countryEnName; if (["ä¸­å›½é¦™æ¸¯", "ä¸­å›½æ¾³é—¨", "ä¸­å›½å°æ¹¾"].includes(country.name)) { const regionName = country.name.replace("ä¸­å›½", "").trim(); countryEnName = provinceEnMap[`${regionName}${regionName === "å°æ¹¾" ? "çœ" : "ç‰¹åˆ«è¡Œæ”¿åŒº"}`]; link = `China-${countryEnName}.html`; } else { countryEnName = country.en.replace(/,/g, '').replace(/\s+/g, '-'); link = `${continentMap[continent]}-${countryEnName}.html`; } const countryHtml = `<a href="${link}"><span class="country-name">${country.name}</span><span class="country-en">${country.en}</span></a>`; countryElement.innerHTML = countryHtml; countryElement.dataset.name = `${country.name}|${country.en}`; contentElement.appendChild(countryElement); if (country.completed) { const badge = document.createElement('div'); badge.className = 'completed-badge'; badge.innerHTML = '<i class="fas fa-check"></i>'; countryElement.appendChild(badge); } allDestinations.push({name: country.name, en: country.en, type: 'international', element: countryElement, completed: country.completed}); }); } }
            
            addEventListeners(); 
            initCollapseState();
            
            // è‡ªåŠ¨æ˜¾ç¤ºä¸€æ¬¡ Toast
            const hintPanel = document.getElementById('hintPanel'); 
            hintPanel.classList.add('show'); 
            setTimeout(() => { hintPanel.classList.remove('show'); }, 3000);
        }

        function initCollapseState() { document.querySelectorAll('.region-header').forEach(header => { header.classList.add('collapsed'); const content = document.getElementById(`${header.dataset.region}Content`); if (content) { content.classList.add('collapsed'); const icon = header.querySelector('i'); if (header.classList.contains('collapsed')) { icon.style.transform = 'rotate(-90deg)'; } } }); }
        
        // æ ¸å¿ƒä¿®æ”¹ï¼šå±•å¼€åŒºåŸŸæ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”çš„ Tab
        function expandRegion(element) { 
            let regionContent = element.closest('.region-content'); 
            if (!regionContent) return; 
            
            // æ£€æŸ¥å…ƒç´ æ˜¯åœ¨ä¸­å›½è¿˜æ˜¯å¢ƒå¤–ï¼Œå¹¶åˆ‡æ¢ Tab
            const parentTab = element.closest('.tab-content');
            if (parentTab && !parentTab.classList.contains('active-view')) {
                if(parentTab.id === 'tab-china') switchTab('china', document.querySelectorAll('.segment-btn')[0]);
                else switchTab('world', document.querySelectorAll('.segment-btn')[1]);
            }

            const regionId = regionContent.id.replace('Content', ''); 
            const regionHeader = document.querySelector(`.region-header[data-region="${regionId}"]`); 
            if (regionHeader && regionHeader.classList.contains('collapsed')) { 
                regionHeader.classList.remove('collapsed'); 
                regionContent.classList.remove('collapsed'); 
                const icon = regionHeader.querySelector('i'); 
                icon.style.transform = 'rotate(0deg)'; 
            } 
        }
        
        function clearAllHighlights() { document.querySelectorAll('.highlight').forEach(el => { el.classList.remove('highlight'); }); document.querySelectorAll('.match-highlight').forEach(el => { el.classList.remove('match-highlight'); }); }
        
        function addEventListeners() {
            const searchInput = document.getElementById('searchInput'); 
            const searchButton = document.getElementById('searchButton'); 
            const clearBtn = document.getElementById('clearBtn'); 
            const suggestionsContainer = document.getElementById('suggestionsContainer'); 
            const collapseExpandBtn = document.getElementById('collapseExpandBtn'); 
            const backToTopBtn = document.getElementById('backToTop'); 
            const hintBtn = document.getElementById('hintBtn'); 
            const hintPanel = document.getElementById('hintPanel'); 
            let hintTimeout;

            function updateSearchSuggestions(query) { suggestionsContainer.innerHTML = ''; if (query.length === 0) { suggestionsContainer.style.display = 'none'; document.querySelectorAll('.match-highlight').forEach(el => { el.classList.remove('match-highlight'); }); return; } const matches = allDestinations.filter(dest => { return ((dest.name && dest.name.toLowerCase().includes(query)) || (dest.en && dest.en.toLowerCase().includes(query))); }); if (matches.length > 0) { matches.forEach(dest => { const suggestion = document.createElement('div'); suggestion.className = 'suggestion-item'; const highlightedName = highlightMatch(dest.name, query); let highlightedEn = ''; if (dest.en) { highlightedEn = highlightMatch(dest.en, query); } suggestion.innerHTML = `<div class="suggestion-name">${highlightedName}</div>${dest.en ? `<div class="suggestion-en">${highlightedEn}</div>` : ''}`; suggestion.addEventListener('click', function() { searchInput.value = dest.name; clearAllHighlights(); dest.element.classList.add('highlight'); expandRegion(dest.element); scrollToElement(dest.element); setTimeout(() => { dest.element.classList.remove('highlight'); }, 3000); suggestionsContainer.style.display = 'none'; }); suggestionsContainer.appendChild(suggestion); }); suggestionsContainer.style.display = 'block'; } else { suggestionsContainer.style.display = 'none'; } document.querySelectorAll('.match-highlight').forEach(el => { el.classList.remove('match-highlight'); }); matches.forEach(dest => { dest.element.classList.add('match-highlight'); }); }
            
            searchInput.addEventListener('input', function() { const query = this.value.trim().toLowerCase(); updateSearchSuggestions(query); clearBtn.classList.toggle('visible', query.length > 0); });
            clearBtn.addEventListener('click', function() { searchInput.value = ''; updateSearchSuggestions(''); clearBtn.classList.remove('visible'); searchInput.focus(); });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­æœç´¢å»ºè®®
            document.addEventListener('click', function(e) { if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target) && !clearBtn.contains(e.target)) { suggestionsContainer.style.display = 'none'; } });
            
            // æŠ˜å é€»è¾‘
            document.querySelectorAll('.region-header').forEach(header => { header.addEventListener('click', function() { const content = document.getElementById(`${this.dataset.region}Content`); if (!content) return; this.classList.toggle('collapsed'); content.classList.toggle('collapsed'); const icon = this.querySelector('i'); if (this.classList.contains('collapsed')) { icon.style.transform = 'rotate(-90deg)'; } else { icon.style.transform = 'rotate(0deg)'; } }); });
            
            // æœç´¢é€»è¾‘
            searchButton.addEventListener('click', performSearch); 
            searchInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') { performSearch(); } });
            
            // å…¨éƒ¨å±•å¼€/æŠ˜å  (ä»…é’ˆå¯¹å½“å‰å¯è§çš„ Tab)
            collapseExpandBtn.addEventListener('click', function() { 
                const activeTab = document.querySelector('.tab-content.active-view');
                const headers = activeTab.querySelectorAll('.region-header'); 
                let allCollapsed = true; 
                headers.forEach(header => { if (!header.classList.contains('collapsed')) { allCollapsed = false; } }); 
                
                headers.forEach(header => { 
                    const content = document.getElementById(`${header.dataset.region}Content`); 
                    if (!content) return; 
                    if (allCollapsed) { 
                        header.classList.remove('collapsed'); content.classList.remove('collapsed'); header.querySelector('i').style.transform = 'rotate(0deg)'; 
                    } else { 
                        header.classList.add('collapsed'); content.classList.add('collapsed'); header.querySelector('i').style.transform = 'rotate(-90deg)'; 
                    } 
                }); 
                // å›¾æ ‡åˆ‡æ¢æ— éœ€æ›´æ”¹ï¼Œä½¿ç”¨ç»Ÿä¸€é€»è¾‘
            });
            
            backToTopBtn.addEventListener('click', scrollToTop); 
            
            hintBtn.addEventListener('click', function(e) { 
                e.stopPropagation(); 
                hintPanel.classList.toggle('show'); 
                if (hintTimeout) clearTimeout(hintTimeout); 
                if (hintPanel.classList.contains('show')) { hintTimeout = setTimeout(() => { hintPanel.classList.remove('show'); }, 3000); } 
            });
            
            document.addEventListener('click', function(e) { if (!hintBtn.contains(e.target) && !hintPanel.contains(e.target)) { hintPanel.classList.remove('show'); } });
        }
        
        function performSearch() { 
            const query = document.getElementById('searchInput').value.trim(); 
            if (!query) return; 
            document.getElementById('suggestionsContainer').style.display = 'none'; 
            const keywordMap = { "é¦™æ¸¯": "ä¸­å›½é¦™æ¸¯", "æ¾³é—¨": "ä¸­å›½æ¾³é—¨", "å°æ¹¾": "ä¸­å›½å°æ¹¾" }; 
            const searchQuery = keywordMap[query] || query; 
            
            const match = allDestinations.find(dest => { return ((dest.name && dest.name.toLowerCase() === searchQuery.toLowerCase()) || (dest.en && dest.en.toLowerCase() === searchQuery.toLowerCase())); }); 
            
            if (match) { 
                clearAllHighlights(); 
                match.element.classList.add('highlight'); 
                expandRegion(match.element); // è¿™é‡Œçš„ expandRegion å·²ç»è¢«æˆ‘ä»¬ä¿®æ”¹ä¸ºæ”¯æŒè‡ªåŠ¨åˆ‡æ¢ Tab
                scrollToElement(match.element); 
                setTimeout(() => { match.element.classList.remove('highlight'); }, 3000); 
            } else { 
                alert(`æ²¡æœ‰æ‰¾åˆ° "${query}"ã€‚è¯·å°è¯•ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ã€‚`); 
            } 
        }
        
        function scrollToElement(element) { element.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' }); }
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
